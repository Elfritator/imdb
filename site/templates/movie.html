{% extends "base.html" %}

{% block title %}
{% set (title, year, note) = movie %}
Movie: {{ title }} ({{ year }})
{% end %}

{% block javascript %}
$(document).ready(function () {
    $('#upvote').click(function (e) {
        e.preventDefault();
        var upvotes = parseInt($.trim($('#upvotes').html()));
        $.get('/upvote/{{ ID }}', function (data) {

            $('#upvotes').html(upvotes+1);
        });
    });
    $('#downvote').click(function (e) {
        e.preventDefault();
        var downvotes = parseInt($.trim($('#downvotes').html()));
        $.get('/downvote/{{ ID }}', function (data) {
            $('#downvotes').html(downvotes+1);
        });
        $.get('/downvote/{{ ID }}');
        /*location.reload();*/
    });

    $('#location').hide();
    $('#locate').click(function (e) {
      e.preventDefault();
      $('#location').toggle('slow');
    });
});
{% end %}

{% block body %}
{% set (title, year, note) = movie %}
    <h1>{{ title }} ({{ year }})</h1>

    {% if admin %}
    <a href="/admin/delete/work/{{ ID }}">Delete</a><br />
    {% end %}

    <div id="poster">
      <img src="/poster/{{ title }}/{{ year }}/" alt="Film poster"/>
    </div>

    
    <span class="info">Rating</span>:
      {% if note %} {{ note }}
      {% else %} -
      {% end %}
    /10
    <br />

    <span class="info">Votes</span>:
    <span id="upvotes">{{ upvotes }}</span><a href="#" id="upvote">+</a>/
    <span id="downvotes">{{ downvotes }}</span><a href="#" id="downvote">-</a>
    <br />

    <span class="info">Genres</span>:
    {% if genres %}
      {{ ', '.join(genres) }}
    {% else %}
       No genres
    {% end %}
    <br />

    <span class="info">Languages</span>:
    {% if languages %}
      {{ ', '.join(languages) }}
    {% else %}
      No languages
    {% end %}
    <br />


    <span class="info">Countries</span>:
    {% if countries %}
      {{ ', '.join(countries) }}. <a href="#" id="locate">Show map</a><br /> 
      <img src="/location/{{ ','.join(countries) }}" alt="Film locations" id="location"/>
    {% else %}
      No countries
    {% end %}


    <h3>Director(s)</h3>
    {% if directors %}
      <ul>
        {% for (fname, lname, num) in directors %}
        <li><a href="/person/{{ fname }}/{{ lname }}/{{ num }}">
            {{ fname }} {{ lname }}</a>
          {% if admin %}(<a href="/admin/delete/director/{{ fname }}/{{ lname }}/{{ num }}/{{ ID }}">delete</a>){% end %}
        </li>
        {% end %}
      </ul>
    {% else %}
      No director
    {% end %}

    <h3>Writer(s)</h3>
    {% if writers %}
      <ul>
        {% for (fname, lname, num) in writers %}
        <li><a href="/person/{{ fname }}/{{ lname }}/{{ num }}">
            {{ fname }} {{ lname }}</a>
          {% if admin %}(<a href="/admin/delete/writer/{{ fname }}/{{ lname }}/{{ num }}/{{ ID }}">delete</a>){% end %}
        </li>
        {% end %}
      </ul>
    {% else %}
      No writer
    {% end %}

    <h3>Actors</h3>
    {% if actors %}
      <ul>
        {% for (fname, lname, num, role) in actors %}
        <li><a href="/person/{{ fname }}/{{ lname }}/{{ num }}">
            {{ fname }} {{ lname }}</a> as <i>{{ role }}</i>
          {% if admin %}(<a href="/admin/delete/actor/{{ fname }}/{{ lname }}/{{ num }}/{{ ID }}/{{ role }}">delete</a>){% end %}
        </li>
        {% end %}
      </ul>
    {% else %}
      No actor
    {% end %}
{% end %}
